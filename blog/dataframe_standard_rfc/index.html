<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.97.0" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Want to super-charge your library by writing dataframe-agnostic code? We&#39;d love to hear from you </title>

  
  <meta name="description" content="An RFC for a dataframe API Standard"> 
  
  
  
  
  

  

  <meta name="author" content="Marco Gorelli">


  <meta property="og:title" content="Want to super-charge your library by writing dataframe-agnostic code? We&#39;d love to hear from you" />
<meta property="og:description" content="An RFC for a dataframe API Standard" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://data-apis.org/blog/dataframe_standard_rfc/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-05-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-05-25T00:00:00+00:00" />


  




  
  
  
  
  

  <link rel="canonical" href="https://data-apis.org/blog/dataframe_standard_rfc/">  

  <link rel="icon" href="../../images/icon.png">

  <link href="../../css/font.css" rel="stylesheet" type="text/css">
  <link href="../../css/kube.min.css" rel="stylesheet" type="text/css">
  <link href="../../css/kube.legenda.css" rel="stylesheet" type="text/css">
  <link href="../../css/highlight.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/default.min.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link href="../../css/master.css" rel="stylesheet" type="text/css">
  <link href="../../css/kube.demo.css" rel="stylesheet" type="text/css">

 <link href="../../css/custom.css" rel="stylesheet" type="text/css">

  <script src="../../js/jquery-2.1.4.min.js" type="text/javascript">
  </script>

  <script type="text/javascript" src="../../js/tocbot.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script>
</head>


<body class="page-kube">
  <header> <div class="show-sm">
    <div id="nav-toggle-box">
      <div id="nav-toggle-brand">
        <a href="../../">Consortium for Python Data API Standards</a>
      </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
    </div>
  </div>
  <div class="hide-sm" id="top">
    <div id="top-brand">
      <a href="../../">
          <img src="../../images/dark_blue_logo.png">
      </a>
    </div>
    <nav id="top-nav-main">
      <ul>
       
       
    <li><a href="https://data-apis.org/array-api/latest/" >Array API</a></li>
    
    <li><a href="https://data-apis.org/dataframe-api/draft/" >DataFrame API</a></li>
    
    <li><a href="../../blog/" >Blog</a></li>
    
    <li><a href="../../annual-reports/" >Annual reports</a></li>
    
      </ul>
    </nav>
    <nav id="top-nav-extra">
      <ul>
        
      </ul>
    </nav>
  </div>
 </header>
  <main>
<div class="push-center" itemscope itemtype="http://schema.org/BlogPosting">
    <meta itemprop="name" content="Want to super-charge your library by writing dataframe-agnostic code? We&#39;d love to hear from you">
<meta itemprop="description" content="An RFC for a dataframe API Standard"><meta itemprop="datePublished" content="2023-05-25T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-05-25T00:00:00+00:00" />
<meta itemprop="wordCount" content="853">
<meta itemprop="keywords" content="APIs,standard,consortium,dataframes,community,pandas,polars,cudf,modin,vaex,koalas,ibis,dask," />
<div id="hero">
    <h1 itemprop="headline">  Want to super-charge your library by writing dataframe-agnostic code? We&#39;d love to hear from you</h1>
    
<blockquote itemprop="description">An RFC for a dataframe API Standard</blockquote>

<time class="post-time"><span class="icon">
  <i class="fa fa-clock-o" aria-hidden="true"></i>
</span>
<span>5 minute read</span>
<span class="icon">
 <i class="fa fa-pencil" aria-hidden="true"></i>
</span>

  Published: <time datetime="2023-05-25T00:00:00&#43;00:00">25 May, 2023</time>

</time>
</div>
<div id="post-box">
<div id="post" itemprop="articleBody">
    
    <h1 align="center">
	<img
		width="400"
		alt="standard-compliant dataframe"
		src="https://github.com/data-apis/dataframe-api-compat/assets/33491632/fb4bc907-2b85-4ad7-8d13-c2b9912b97f5">
</h1>
<p>Tired of getting lost in if-then statements when dealing with API differences
between dataframe libraries? Would you like to be able to write your code
once, have it work with all major dataframe libraries, and be done?
Let&rsquo;s learn about an initiative which will enable you to write
cross-dataframe code - no special-casing nor data conversions required!</p>
<h2 id="why-would-i-want-this-anyway">Why would I want this anyway?</h2>
<p>Say you want to write a function which selects rows of a dataframe based
on the <a href="https://en.wikipedia.org/wiki/Standard_score">z-score</a> of a given
column, and you want it to work with any dataframe library. How might
you write that?</p>
<h3 id="solution-1">Solution 1</h3>
<p>Here&rsquo;s a typical solution:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">remove_outliers</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">z_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">z_score</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">polars</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">z_score</span> <span class="o">=</span> <span class="p">((</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">)</span> <span class="o">-</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">column</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">z_score</span><span class="o">.</span><span class="n">is_between</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">some_other_library</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span></code></pre></div><p>This quickly gets unwieldy. Libraries like <code>cudf</code> and <code>modin</code> <em>might</em> work
in the <code>isinstance(df, pandas.DataFrame)</code> arm, but there&rsquo;s no guarantee -
their APIs are similar, but subtly different. Furthermore, as new libraries
come out, you&rsquo;d have to keep updating your function to add new <code>if</code> statements.</p>
<p>Can we do better?</p>
<h3 id="solution-2-interchange-protocol">Solution 2: Interchange Protocol</h3>
<p>An alternative, which wouldn&rsquo;t involve special-casing, could be to
leverage the <a href="https://data-apis.org/dataframe-protocol/latest/index.html">DataFrame interchange protocol</a>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">remove_outliers</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_pd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">interchange</span><span class="o">.</span><span class="n">from_dataframe</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">z_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_pd</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_pd</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">df_pd</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df_pd</span><span class="p">[</span><span class="n">z_score</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</span></span></code></pre></div><p>We got out of having to write if-then statements (ðŸ¥³), but there&rsquo;s still a
couple of issues:</p>
<ol>
<li>we had to convert to pandas: this might be expensive if your data was
originally stored on GPU;</li>
<li>the return value is a <code>pandas.DataFrame</code>, rather than an object of your
original dataframe library.</li>
</ol>
<p>Can we do better? Can we really have it all?</p>
<h3 id="solution-3-introducing-the-dataframe-standard">Solution 3: Introducing the Dataframe Standard</h3>
<p>Yes, we really can. To write cross-dataframe code, we&rsquo;ll take these steps:</p>
<ol>
<li>enable the Standard using <code>.__dataframe_standard__</code>. This will return
a Standard-compliant dataframe;</li>
<li>write your code, using the <a href="https://data-apis.org/dataframe-api/draft/API_specification/index.html">Dataframe Standard specification</a></li>
<li>(optional) return a dataframe from your original library by calling <code>.dataframe</code>.</li>
</ol>
<p>Let&rsquo;s see how this would look like for our <code>remove_outliers</code> example function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">remove_outliers</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Get a Standard-compliant dataframe.</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># NOTE: this has not yet been upstreamed, so won&#39;t work out-of-the-box!</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># See &#39;resources&#39; below for how to try it out.</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_standard</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">__dataframe_standard__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Use methods from the Standard specification.</span>
</span></span><span class="line"><span class="cl">    <span class="n">col</span> <span class="o">=</span> <span class="n">df_standard</span><span class="o">.</span><span class="n">get_column_by_name</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">z_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="n">col</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">col</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_standard_filtered</span> <span class="o">=</span> <span class="n">df_standard</span><span class="o">.</span><span class="n">get_rows_by_mask</span><span class="p">((</span><span class="n">z_score</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z_score</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Return the result as a dataframe from the original library.</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">df_standard_filtered</span><span class="o">.</span><span class="n">dataframe</span>
</span></span></code></pre></div><p>This will work, as if by magic, on any dataframe with a Standard-compliant implementation.
But it&rsquo;s not magic, of course, it&rsquo;s the power of standardisation!</p>
<h2 id="the-standards-philosophy---will-all-dataframe-libraries-have-the-same-api-one-day">The Standard&rsquo;s philosophy - will all dataframe libraries have the same API one day?</h2>
<p>Let&rsquo;s start with what this isn&rsquo;t: the Standard isn&rsquo;t an attempt to force all dataframe
libraries to have the same API. It also isn&rsquo;t a way to convert
between dataframes: the <a href="https://data-apis.org/dataframe-protocol/latest/index.html">Interchange Protocol</a>,
whose adoption is increasing, already does that. It also doesn&rsquo;t aim to standardise
domain or industry specific functionality.</p>
<p>Rather, it is minimal set of essential dataframe functionality which will work
the same way across libraries. It will behave in a strict and predictable manner
across dataframe libraries. Library authors trying to write dataframe-agnostic
code are expected to greatly benefit from this, as are their users.</p>
<h2 id="whos-this-for-do-i-need-to-learn-yet-another-api">Who&rsquo;s this for? Do I need to learn yet another API?</h2>
<p>If you&rsquo;re a casual user, then probably not.
The Dataframe Standard is currently mainly targeted towards library developers,
who wish to support multiple dataframe libraries. Users of non-pandas dataframe
libraries would then be able to seamlessly use the Python packages which
provide functionality for dataframes (e.g. visualisation, feature engineering,
data cleaning) without having to do any expensive data conversions.</p>
<p>If you&rsquo;re a library author, then we&rsquo;d love to hear from you. Would this be
useful to you? We expect it to be, as the demand for dataframe-agnostic tools
certainly seems to be there:</p>
<ul>
<li><a href="https://github.com/mwaskom/seaborn/issues/3277">https://github.com/mwaskom/seaborn/issues/3277</a>,</li>
<li><a href="https://github.com/scikit-learn/scikit-learn/issues/25896">https://github.com/scikit-learn/scikit-learn/issues/25896</a></li>
<li><a href="https://github.com/plotly/plotly.py/issues/3637">https://github.com/plotly/plotly.py/issues/3637</a></li>
<li>(many, many more&hellip;)</li>
</ul>
<h2 id="are-we-there-yet-what-lies-ahead">Are we there yet? What lies ahead?</h2>
<p>This is just a first draft, based on design discussions between authors from various
dataframe libraries, and a request for comments (RFC). Our goal is to solicit input
from a wider range of potential stakeholders, and evolve the Standard throughout
the rest of 2023, resulting in a first official release towards the end of the year.</p>
<p>Future plans include:</p>
<ul>
<li>increasing the scope of the Standard based on real-world code from widely used
packages (currently, the spec is very minimal);</li>
<li>creating implementations of the Standard for several major dataframe libraries
(initially available as a separate <code>dataframe-api-compat</code> package);</li>
<li>creating a cross-dataframe test-suite;</li>
<li>aiming to ensure each major dataframe library has a <code>__dataframe_standard__</code> method.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>We&rsquo;ve introduced the Dataframe Standard, which allows you to write cross-dataframe code.
We learned about its philosophy, as well as what it doesn&rsquo;t aim to be. Finally, we saw
what plans lie ahead - the Standard is in active development, so please watch this space!</p>
<h2 id="resources">Resources</h2>
<ul>
<li>Read more on the <a href="https://data-apis.org/dataframe-api/">official website</a>, and contribute to the discussion on the <a href="https://github.com/data-apis/dataframe-api">GitHub repo</a></li>
<li>Try out an <a href="https://github.com/data-apis/dataframe-api-compat">implementation for pandas and polars</a>!</li>
</ul>


</div>

    <div class="">
        <p>
  Published
  
    
      by <span itemprop="author">Marco Gorelli</span>
    
  
  <time datetime="2023-05-25T00:00:00&#43;00:00">
    25 May, 2023
  </time>
  
    in <span itemprop="articleSection"><a href="../../categories/consortium/">Consortium</a> and <a href="../../categories/standardization/">Standardization</a></span>
  
  
    and tagged <a href="../../tags/apis/">APIs</a>, <a href="../../tags/community/">community</a>, <a href="../../tags/consortium/">consortium</a>, <a href="../../tags/cudf/">cudf</a>, <a href="../../tags/dask/">dask</a>, <a href="../../tags/dataframes/">dataframes</a>, <a href="../../tags/ibis/">ibis</a>, <a href="../../tags/koalas/">koalas</a>, <a href="../../tags/modin/">modin</a>, <a href="../../tags/pandas/">pandas</a>, <a href="../../tags/polars/">polars</a>, <a href="../../tags/standard/">standard</a> and <a href="../../tags/vaex/">vaex</a>
  
  using <span itemprop="wordCount">853</span> words.
</p>

        
  



  <aside>
    <heade><strong>Related Content</strong></header>
    <hr>
    <ul>
      
      
        <li><a href="../../blog/eoss6_award/">CZI EOSS 6 Award to Advance Array Interoperability within the PyData Ecosystem</a> &ndash; 6 minutes
      
        <li><a href="../../blog/array_api_v2023_release/">2023 release of the Array API Standard</a> &ndash; 10 minutes
      
        <li><a href="../../blog/array_api_v2022_release/">2022 release of the Array API Standard</a> &ndash; 8 minutes
      
        <li><a href="../../blog/array_api_standard_release/">First release of the Array API Standard</a> &ndash; 7 minutes
      
        <li><a href="../../blog/announcing_the_consortium/">Announcing the Consortium for Python Data API Standards</a> &ndash; 11 minutes
      
        <li><a href="../../blog/dataframe_protocol_rfc/">Towards dataframe interoperability</a> &ndash; 8 minutes
      
    </ul>
  </aside>


    </div>
    
    
    
</div>
</div>
</main>
  <footer>   <footer id="footer">
    <nav>
      <ul>
        <li><span>Consortium</span></li>
        <li>
          <a href="../../blog/">Blog</a>
        </li>
        <li>
          <a href="https://data-apis.org/array-api/latest/">Array API</a>
        </li>
        <li>
          <a href="https://github.com/data-apis">GitHub</a>
        </li>
          <li>
          <a href="https://github.com/data-apis/governance/blob/main/consortium_governance.md">Governance</a>
        </li>
          <li>
          <a href="https://github.com/data-apis/.github/blob/main/CODE_OF_CONDUCT.md">Code of Conduct</a>
        </li>
      </ul>
    </nav>
    <p>&copy Consortium Members; Licence MIT.</p>
  </footer>
 </footer>


  <script src="../../js/kube.js" type="text/javascript">
  </script>
  <script src="../../js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="../../js/master.js" type="text/javascript">
  </script>
</body>

</html>
